# BK179-CRACK: 报考一起走 (www.bk179.com) 模拟操作工具

## 简介
(Generated by gemini)
本项目是一个使用 Python 编写的工具，旨在模拟对“报考一起走”网站（www.bk179.com）的核心用户操作。它通过封装底层的HTTP请求，提供了简单易用的方法来实现自动化登录、查询分数位次和修改用户分数等功能。

这个项目对于理解和分析基于现代前端框架（如 Next.js Server Actions）和传统 API 混合架构的网站交互非常有帮助。

## 功能特性

- **会话管理**: 自动处理和维护Cookie，支持通过字符串初始化Cookie。
- **用户登录**: 模拟Next.js Server Action进行用户登录，并能判断登录是否成功。
- **查询分数位次**: 模拟调用站点的RESTful API，根据给定分数查询其在特定省份和科类中的排名。
- **修改用户分数**: 模拟用户在“智能填报”页面更新高考分数和排名的操作。
- **获取用户分数记录ID**: 能够从页面数据中自动提取用户当前分数记录在数据库中的唯一ID。

## 技术细节解析

本项目揭示了 `www.bk179.com` 网站的混合技术架构：

1.  **Next.js Server Actions (RSC)**:
    - 用于处理**有状态的、改变服务器数据的操作**，如**登录**和**修改分数**。
    - 这类请求的 `Accept` 头为 `text/x-component`，并包含 `Next-Action` 和 `Next-Router-State-Tree` 等特殊头部。
    - 响应是流式的、逐行的数据，包含了业务结果和更新UI所需的组件描述。

2.  **RESTful API**:
    - 用于处理**无状态的、纯数据查询操作**，如**根据分数查排名** (`/api/bigdata/school/listyearFenduan`)。
    - 这类请求需要用户认证，通过 `user-token` (JWT) 和一个动态生成的 `Authorization` 签名头来保护。

3.  **认证机制**:
    - **登录**: 通过 Server Action 完成，成功后服务器通过 `Set-Cookie` 头返回 `user-token` (JWT)。
    - **API调用**: 必须在请求的 Cookie 中携带有效的 `user-token`，并在头部包含一个基于请求参数和密钥动态计算出的 `Authorization` 签名。

## 如何使用

### 1. 安装依赖

本项目依赖 `requests` 库。请通过pip安装：

```bash
pip install requests
```

### 2. 配置

在使用前，你需要配置以下两个关键信息：

- **Cookie**:
  - `cookie`: 脚本初始化时需要一个基础的Cookie字符串。你可以直接从浏览器登录 `www.bk179.com` 后，通过开发者工具复制请求中的Cookie。**特别注意**，`acw_tc` 是一个有时效性的反爬虫cookie，如果失效，需要重新获取。
- **用户名和密码**:
  - `username` 和 `password`: 在 `if __name__ == '__main__':` 代码块中，填入你在“报考一起走”网站注册的真实账号和密码。

```python
if __name__ == '__main__':
    # 1. 填入你的账号和密码
    username = 'YOUR_USERNAME'
    password = 'YOUR_PASSWORD'
    
    # 2. 填入从浏览器复制的基础Cookie
    cookie = 'appType=normal; appProvinceId=450000000000; acw_tc=...' # 建议使用最新的acw_tc

    # 初始化并开始操作
    bk179 = BK179CRACK(cookie)
    if bk179.login(username, password):
        print("\n登录成功，开始执行后续操作...")
        bk179.change_mark(600)
    else:
        print("\n登录失败，无法执行后续操作。")
```

### 3. 运行脚本

配置完成后，直接运行Python脚本即可：

```bash
python your_script_name.py
```

脚本将依次执行登录、获取排名、更新分数等操作，并打印出每一步的结果。

## 类和方法说明

### `BK179CRACK` 类

#### `__init__(self, cookie='')`
- 构造函数，初始化一个 `requests.Session` 对象，并处理传入的cookie字符串。

#### `login(self, username, password)`
- **功能**: 执行登录操作。
- **参数**:
  - `username` (str): 用户名。
  - `password` (str): 密码。
- **返回**: `True` 表示登录成功，`False` 表示失败。

#### `get_zone(self, mark)`
- **功能**: 查询指定分数的全省排名（位次）。
- **参数**:
  - `mark` (int): 要查询的高考分数。
- **返回**: `int` 类型的排名。

#### `change_mark(self, mark, jiafen=0)`
- **功能**: 更新当前登录用户的分数、排名和加分项。
- **参数**:
  - `mark` (int): 新的高考分数。
  - `jiafen` (int, optional): 加分值，默认为0。
- **返回**: `True` 表示设置成功，`False` 表示失败。

#### `get_uid(self)`
- **功能**: 从“智能填报”页面内容中解析出当前分数记录的数据库ID。
- **返回**: `int` 类型的记录ID。

## 注意事项与局限性

1.  **动态值**:
    - **`Next-Action`**: 这个哈希值是硬编码在代码中的。如果网站前端更新，该值可能会改变，导致脚本失效。届时需要重新通过浏览器抓包获取新的值。
    - **`Authorization`**: 在 `get_zone` 方法中，`Authorization` 签名被硬编码为一个固定值。这在实际中几乎肯定会失效，因为签名通常是动态生成的。要使该功能稳定运行，需要逆向分析网站的JavaScript代码，找出其签名算法。
    - **`acw_tc` Cookie**: 这是一个有时效性的反爬虫Cookie。如果脚本因请求被拦截而失败，最可能的原因就是它已过期。需要从浏览器获取最新的值。

2.  **适用范围**:
    - 当前脚本的参数（如 `kelei='li'`）是针对广西理科考生的。如需用于其他省份或科类，需要相应地修改请求参数和Cookie中的`appProvinceId`。

3.  **免责声明**:
    - 本项目仅用于学习和技术研究目的。请勿用于任何非法用途或商业活动。所有操作应遵守目标网站的用户协议。因使用本脚本而导致的任何后果，由使用者自行承担。

## 许可证

本项目采用 [MIT](LICENSE) 许可证。